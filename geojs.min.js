(function(a){var b={},c=[1.406245461070741,1.321415085624082,1.077179995861952,.703119412486786,.488332580888611],d=typeof module!="undefined"&&module.exports,e=Math.PI*2,f=Math.PI/2,g=3,h=Math.PI/180,i=180/Math.PI,j=90,k=-j,l=180,m=-l,n=j*h,o=-n,p=l*h,q=-p,r=1e3,s=6371,t=s*r,u=.08181919084262157,v=1e-7,w=12,x=/[\,\s]+/,y=b.Pos=function(a,b,c){if(a&&a.split){var d=a.split(x);d.length>1&&(a=d[0],b=d[1])}else a&&a.lat&&(b=a.lon||a.lng,a=a.lat);this.lat=parseFloat(a||0),this.lon=parseFloat(b||0),this.radius=c||s};y.prototype={constructor:y,bearing:function(a){var b=this.lat*h,c=a.lat*h,d=(a.lon-this.lon)*h,e=Math.sin(d)*Math.cos(c),f=Math.cos(b)*Math.sin(c)-Math.sin(b)*Math.cos(c)*Math.cos(d),g=Math.atan2(e,f);return(g*i+360)%360},clean:function(){return this.toString()},copy:function(){return new y(this.lat,this.lon)},distanceTo:function(a){if(!a||this.empty()||a.empty())return 0;var b=(a.lat-this.lat)*h/2,c=(a.lon-this.lon)*h/2,d=Math.sin(b)*Math.sin(b)+Math.cos(this.lat*h)*Math.cos(a.lat*h)*Math.sin(c)*Math.sin(c),e=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d));return this.radius*e},equalTo:function(a){return a&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){if(a)for(var b=a.length;b--;)if(this.equalTo(a[b]))return!0;return!1},offset:function(a,b){var c=a/this.radius,d=b/this.radius,g=this.lat*h,j=this.lon*h,k=g+c,l=Math.asin(Math.sin(d)/Math.cos(g)),m=j+l;return k=(k+f)%Math.PI-f,m%=e,new y(k*i,m*i)},to:function(a,b){typeof a=="object"&&(a=this.bearing(a));var c=b/this.radius,d=a*h,e=this.lat*h,f=this.lon*h,g=Math.asin(Math.sin(e)*Math.cos(c)+Math.cos(e)*Math.sin(c)*Math.cos(d)),j=f+Math.atan2(Math.sin(d)*Math.sin(c)*Math.cos(e),Math.cos(c)-Math.sin(e)*Math.sin(g));return j=(j+3*Math.PI)%(2*Math.PI)-Math.PI,new y(g*i,j*i)},toBounds:function(a){var b=a.radians(),c=this.lat*h,d=this.lon*h,f=c-b,g=c+b,j,k;if(f>o&&g<n){var r=Math.asin(Math.sin(b)/Math.cos(c));j=d-r,j<q&&(j+=e),k=d+r,k>p&&(k-=e)}else f=Math.max(f,o),g=Math.min(g,n),j=m,k=l;return new A(new y(f*i,j*i),new y(g*i,k*i))},toString:function(a){return this.lat+(a||" ")+this.lon},valid:function(){return!isNaN(this.lat)&&!isNaN(this.lon)}};var z=b.Line=function(a){this.positions=[];for(var b=a.length;b--;)typeof a[b]=="string"?this.positions[b]=new y(a[b]):this.positions[b]=a[b]};z.prototype={constructor:z,distance:function(){var a=0,b=[],c;for(var d=this.positions.length-1;d--;)c=this.positions[d].distanceTo(this.positions[d+1]),a+=b[d]=c;return{total:a,segments:b}},simplify:function(a){a=a||20;var b=this.positions,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=[],w=[],x=[],y=Math.PI/180/2;if(b.length<3)return b;c=b.length,l=a*360/(2*Math.PI*6378137),l*=l,e=0,w[0]=0,x[0]=c-1,d=1;while(d>0){f=w[d-1],g=x[d-1],d--;if(g-f>1){m=b[g].lon-b[f].lon,n=b[g].lat-b[f].lat,Math.abs(m)>180&&(m=360-Math.abs(m)),m*=Math.cos(y*(b[g].lat+b[f].lat)),o=m*m+n*n;for(h=f+1,i=f,k=-1;h<g;h++)p=b[h].lon-b[f].lon,q=b[h].lat-b[f].lat,Math.abs(p)>180&&(p=360-Math.abs(p)),p*=Math.cos(y*(b[h].lat+b[f].lat)),r=p*p+q*q,s=b[h].lon-b[g].lon,t=b[h].lat-b[g].lat,Math.abs(s)>180&&(s=360-Math.abs(s)),s*=Math.cos(y*(b[h].lat+b[g].lat)),u=s*s+t*t,r>=o+u?j=u:u>=o+r?j=r:j=(p*n-q*m)*(p*n-q*m)/o,j>k&&(i=h,k=j);k<l?(v[e]=f,e++):(d++,w[d-1]=i,x[d-1]=g,d++,w[d-1]=f,x[d-1]=i)}else v[e]=f,e++}v[e]=c-1,e++;var z=[];for(h=0;h<e;h++)z.push(b[v[h]]);return this.positions=z,this},traverse:function(a,b){var c=0,d=0;if(!b||!b.segments)b=this.distance();if(a>b.total)return this.positions[this.positions.length-1];if(a<=0)return this.positions[0];while(d<b.segments.length){c+=b.segments[d];if(c>a){c-=b.segments[d];break}d++}if(d<this.positions.length-1){var e=this.positions[d],f=this.positions[d+1],g=e.bearing(f);return e.to(g,a-c)}return this.positions[d]}};var A=b.BBox=function(a,b){if(a&&a.splice){var c=b,d=new y(j,l),e=new y(k,m);for(var f=a.length;f--;){var g=typeof a[f]=="string"?new y(a[f]):a[f];g&&(g.lat<d.lat&&(d.lat=g.lat),g.lat>e.lat&&(e.lat=g.lat),g.lon<d.lon&&(d.lon=g.lon),g.lon>e.lon&&(e.lon=g.lon))}this.min=d,this.max=e;if(typeof c=="undefined"){var h=this.size();c=Math.max(h.x,h.y)*.3}this.min=new y(d.lat-c,(d.lon-c)%360),this.max=new y(e.lat+c,(e.lon+c)%360)}else a&&a.min?(this.min=new y(a.min),this.max=new y(a.max)):(this.min=new y(a),this.max=new y(b))};A.prototype={constructor:A,bestZoomLevel:function(a,b){var d=this.center(),e=1e3,f=Math.min(Math.round(Math.abs(d.lat)*.05),c.length),g=c[f],h=this.size(),i=Math.ceil(Math.log(c[3]*b/h.y)/Math.LN2),j=Math.ceil(Math.log(g*a/h.x)/Math.LN2);return Math.min(isNaN(i)?e:i,isNaN(j)?e:j)},center:function(){var a=this.size();return new y(this.min.lat+a.y/2,this.min.lon+a.x/2)},expand:function(a){return new A(new y(this.min.lat-a,(this.min.lon-a)%360),new y(this.max.lat+a,(this.max.lon+a)%360))},size:function(a){var b={x:0,y:this.max.lat-this.min.lat};return typeof a!="undefined"&&a&&this.min.lon>this.max.lon?b.x=360-this.min.lon+this.max.lon:b.x=this.max.lon-this.min.lon,b},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){var a=this.min.copy(),b=this.max.copy();for(var c=arguments.length;c--;)if(arguments[c]){var d=arguments[c].min,e=arguments[c].max;a.lat=Math.min(a.lat,d.lat),a.lon=Math.min(a.lon,d.lon),b.lat=Math.max(b.lat,e.lat),b.lon=Math.max(b.lon,e.lon)}return new A(a,b)}};var B=b.Distance=function(a){if(typeof a=="string"){var b=(a.replace(/\d|\.|\s/g,"")||"m").toLowerCase(),c={km:1e3};a=parseFloat(a)*(c[b]||1)}this.meters=a||0};B.prototype={add:function(){var a=this.meters;for(var b=arguments.length;b--;){var c=typeof arguments[b]=="string"?new B(arguments[b]):arguments[b];a+=c.meters}return new B(a)},radians:function(a){return typeof a!="undefined"?(this.meters=a*t,this):this.meters/t},toString:function(){return this.meters>r?(this.meters/10|0)/100+"km":this.meters+"m"}},typeof module!="undefined"&&module.exports?module.exports=b:typeof define!="undefined"?define("GeoJS",[],function(){return b}):a.GeoJS=b})(this)